# DB ↔ API Fit Analysis

## 0) How to use this analysis

### 0.1 SME / DB owner: answer directly in this file
- The SME SHOULD edit this analysis document directly.
- Fill section **7.2 SME answer worksheet**.

### 0.2 Producer: complete DB mapping (generated by the skill)
- After the SME fills the answers, run a **follow-up analysis**.
- In follow-up mode, the skill will:
  - Validate that answers are clear enough (strict gating)
  - Map API data requirements to DB tables/columns/constraints
  - Identify gaps and integration risks
  - Produce an updated analysis report under:
    - `docs/specifications/<demand_folder>/05-data-fit-analysis/`

### 0.3 Producer: iterate until gaps are closed
- If gaps require DB changes or API changes, decide and update the source artifacts.
- Re-run follow-up until major gaps are resolved.

### 0.4 Copy/paste to run the follow-up analysis
```text
@[/olaf-analyze-db-api-fit]
demand_folder: <demand_folder>
analysis_mode: followup
previous_analysis_path: <path-to-previous-data-fit-analysis>
db_artifacts_paths:
  - external/spring-petclinic-rest/src/main/resources/db/postgres/schema.sql
  - external/spring-petclinic-rest/src/main/resources/db/postgres/data.sql
```

### 0.5 Strict gating rule
- If any **High** priority question is unanswered, ambiguous, or missing an explicit **TBD + decision owner + target date**, the follow-up run MUST stop and ask for clarification.

## 1) Analysis metadata
- Demand folder:
- Input spec paths:
  - Functional spec:
  - Functional spec (detailed):
  - OpenAPI:
- Analysis timestamp (YYYYMMDD-HHmm):
- Analysis mode (initial/followup):
- DB artifacts provided:

## 2) Executive summary
- Overall fit assessment (High/Medium/Low):
- Major blockers (top 5):
- Key assumptions:

## 3) Candidate microservice boundaries (bounded contexts)
For each candidate service:
- Scope and responsibilities:
- Data it should own (write authority):
- Data it must read (reference/replicated):
- Cross-boundary dependencies:

## 4) Data requirements inventory
### 4.1 Domain concepts
- Entities:
- Value objects:
- Enums:

### 4.2 Endpoint-level requirements
For each endpoint/use case:
- Required request fields (validation)
- Required response fields
- Search/filter/sort requirements
- Authorization/identity needs
- Derived/aggregated fields

## 5) DB mapping (if DB artifacts provided)
### 5.1 Mapping table
Provide a mapping table for required data elements.

Suggested columns:
- Requirement ID / Field
- Used by endpoint(s)
- Meaning
- DB source (table.column / view)
- Join path / relationship
- Type compatibility
- Constraints support
- Coverage (Covered / Partial / Missing / Ambiguous)
- Notes

### 5.2 Findings
- Covered requirements:
- Partial coverage (derivation/joins needed):
- Missing data gaps:
- Ambiguities:

### 5.3 Performance considerations
- Filters/sorts needing indexes:
- High-cost joins:
- Expected hot paths:

## 6) DB artifacts request (if missing)
Use checklist: `/kb/db-artifacts-request-checklist.md`.

## 7) Questions for the SME / DB owner
Use the template: `templates/questions-table-format.md`.

### 7.1 How to provide answers (for the SME)
- Answer **each question ID** (Q-001, Q-002, …).
- If the question includes “Proposed options”, you MAY answer using:
  - the option text, and
  - any necessary rule details (thresholds, durations, constraints).
- If none of the options fit, answer with **"Custom:"** followed by the rule in plain language.
- If you cannot decide now, answer with **"TBD"** and provide who decides + by when.

### 7.2 SME answer worksheet
Provide long-form answers here. The follow-up analysis will extract answers from this section.

#### Q-001

#### Q-002

#### Q-003

#### Q-004

#### Q-005

#### Q-006

#### Q-007

#### Q-008

#### Q-009

## 8) Gaps, risks, and decisions
### 8.1 Gaps

### 8.2 Risks

### 8.3 Decisions needed

## 9) Recommended next steps
- What to request next:
- What to confirm:
- What can be implemented now (without DB changes):
